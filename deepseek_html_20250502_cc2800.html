<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Roof Inspection Report Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; }
        button { background: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .image-preview { max-width: 200px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Roof Inspection Report Generator</h1>
    
    <div class="section">
        <h3>Property Information</h3>
        <input type="text" id="address" placeholder="Property Address" required>
        <input type="date" id="date" required>
        <input type="text" id="inspector" placeholder="Inspector Name" required>
        <select id="condition" required>
            <option value="">Select Roof Condition</option>
            <option value="Good">Good</option>
            <option value="Fair">Fair</option>
            <option value="Poor">Poor</option>
        </select>
    </div>

    <div class="section">
        <h3>Issues & Photos</h3>
        <div id="issues">
            <div class="issue">
                <textarea placeholder="Issue description"></textarea>
                <input type="file" accept="image/*" multiple class="image-upload">
                <div class="image-previews"></div>
            </div>
        </div>
        <button onclick="addIssue()">âž• Add Another Issue</button>
    </div>

    <button onclick="generatePDF()" style="background: #4CAF50;">ðŸ”— Generate PDF Report</button>

    <script>
        window.jsPDF = window.jspdf.jsPDF;

        // Add new issue section
        function addIssue() {
            const div = document.createElement('div');
            div.className = 'issue';
            div.innerHTML = `
                <textarea placeholder="Issue description"></textarea>
                <input type="file" accept="image/*" multiple class="image-upload">
                <div class="image-previews"></div>
            `;
            document.getElementById('issues').appendChild(div);
            addImagePreview(div);
        }

        // Handle image previews
        function addImagePreview(container) {
            container.querySelector('.image-upload').addEventListener('change', function(e) {
                const previews = container.querySelector('.image-previews');
                previews.innerHTML = '';
                
                Array.from(e.target.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = document.createElement('img');
                        img.className = 'image-preview';
                        img.src = e.target.result;
                        previews.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            });
        }

        // Initialize first issue
        addImagePreview(document.querySelector('.issue'));

        async function generatePDF() {
            const pdf = new jsPDF();
            
            // Basic Info
            pdf.setFontSize(18);
            pdf.text("ROOF INSPECTION REPORT", 105, 20, { align: 'center' });
            
            pdf.setFontSize(12);
            let y = 40;
            
            // Property Information
            pdf.text(`Address: ${document.getElementById('address').value}`, 20, y);
            y += 10;
            pdf.text(`Date: ${document.getElementById('date').value}`, 20, y);
            y += 10;
            pdf.text(`Inspector: ${document.getElementById('inspector').value}`, 20, y);
            y += 10;
            pdf.text(`Condition: ${document.getElementById('condition').value}`, 20, y);
            y += 20;

            // Issues with Images
            document.querySelectorAll('.issue').forEach(async (issue, index) => {
                const description = issue.querySelector('textarea').value;
                const images = issue.querySelector('.image-upload').files;

                // Add issue text
                pdf.text(`Issue #${index + 1}: ${description}`, 20, y);
                y += 10;

                // Add images
                if(images.length > 0) {
                    for(let i = 0; i < images.length; i++) {
                        if(y > 250) { // Prevent overflow
                            pdf.addPage();
                            y = 20;
                        }
                        
                        const imgData = await readFileAsDataURL(images[i]);
                        pdf.addImage(imgData, 'JPEG', 20, y, 80, 60);
                        y += 70;
                    }
                }
                
                y += 10;
            });

            pdf.save('roof-inspection-report.pdf');
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>