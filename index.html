<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep the existing style section unchanged -->
    <!-- Add EXIF library for image orientation handling -->
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
</head>
<body>
    <!-- Add onload to initialize date -->
    <body onload="setDefaultDate()">
    
    <!-- Date input with default value -->
    <div class="form-group">
        <label>Inspection Date:</label>
        <input type="date" id="date" required>
    </div>

    <!-- Rest of the HTML remains unchanged -->

    <script>
        // Set default date to today
        function setDefaultDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('date').value = `${yyyy}-${mm}-${dd}`;
        }

        // Modified readFile function to handle orientation
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    EXIF.getData(file, function() {
                        const orientation = EXIF.getTag(this, 'Orientation');
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            // Set canvas dimensions
                            if (orientation > 4) {
                                canvas.width = img.height;
                                canvas.height = img.width;
                            } else {
                                canvas.width = img.width;
                                canvas.height = img.height;
                            }

                            // Apply orientation transformations
                            switch(orientation) {
                                case 2: ctx.transform(-1, 0, 0, 1, img.width, 0); break;
                                case 3: ctx.transform(-1, 0, 0, -1, img.width, img.height); break;
                                case 4: ctx.transform(1, 0, 0, -1, 0, img.height); break;
                                case 5: ctx.transform(0, 1, 1, 0, 0, 0); break;
                                case 6: ctx.transform(0, 1, -1, 0, img.height, 0); break;
                                case 7: ctx.transform(0, -1, -1, 0, img.height, img.width); break;
                                case 8: ctx.transform(0, -1, 1, 0, 0, img.width); break;
                            }

                            ctx.drawImage(img, 0, 0);
                            resolve(canvas.toDataURL('image/jpeg'));
                        };
                        img.src = e.target.result;
                    });
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Modified PDF generation image handling
        async function generatePDF() {
            try {
                // ... existing PDF setup code ...

                // Add Photos with original orientation
                for(let j = 0; j < photos.length; j++) {
                    const imgData = await readFile(photos[j]);
                    const imgProps = doc.getImageProperties(imgData);
                    
                    // Use original dimensions without rotation
                    const width = imgProps.width * 0.25;
                    const height = imgProps.height * 0.25;

                    // ... existing page break logic ...

                    doc.addImage(imgData, 'JPEG', 20, yPos, width, height);
                    yPos += height + 10;
                }

                // ... rest of the PDF generation code ...
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        // ... rest of the existing JavaScript code ...
    </script>
</body>
</html>
