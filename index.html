<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- ... (keep previous head content) ... -->
    <style>
        /* ... (keep previous styles) ... */
        .error-message {
            color: red;
            margin-top: 5px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- ... (keep previous body content until script) ... -->

    <script>
        function getLocation() {
            const addressField = document.getElementById('address');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            
            if (!navigator.geolocation) {
                errorDiv.textContent = "Geolocation is not supported by your browser";
                addressField.parentNode.insertBefore(errorDiv, addressField.nextSibling);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                position => {
                    // Remove any existing error messages
                    const existingErrors = document.querySelectorAll('.error-message');
                    existingErrors.forEach(error => error.remove());

                    // Use a geocoding service to get actual address (requires API key)
                    getAddressFromCoords(position.coords.latitude, position.coords.longitude)
                        .then(address => {
                            addressField.value = address;
                        })
                        .catch(error => {
                            addressField.value = `Lat: ${position.coords.latitude.toFixed(6)}, Long: ${position.coords.longitude.toFixed(6)}`;
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'error-message';
                            errorDiv.textContent = "Could not get street address (showing coordinates instead)";
                            addressField.parentNode.insertBefore(errorDiv, addressField.nextSibling);
                        });
                },
                error => {
                    const errorMessage = {
                        PERMISSION_DENIED: "User denied the request for geolocation.",
                        POSITION_UNAVAILABLE: "Location information is unavailable.",
                        TIMEOUT: "The request to get user location timed out.",
                        UNKNOWN_ERROR: "An unknown error occurred."
                    }[error.code] || "Error getting location";
                    
                    errorDiv.textContent = errorMessage;
                    addressField.parentNode.insertBefore(errorDiv, addressField.nextSibling);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        }

        async function getAddressFromCoords(lat, lng) {
            // YOU NEED TO GET AN API KEY FROM A GEOCODING SERVICE LIKE:
            // - OpenCage (https://opencagedata.com)
            // - Google Maps Platform (https://developers.google.com/maps)
            
            // Example using OpenCage (replace with your API key):
            const API_KEY = 'YOUR_API_KEY_HERE';
            const response = await fetch(
                `https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lng}&key=${API_KEY}`
            );
            
            const data = await response.json();
            return data.results[0].formatted;
        }
    </script>
</body>
</html>
