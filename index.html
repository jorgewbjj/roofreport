<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roof Inspection Report</title>
    <style>
        /* ... (keep all previous styles unchanged) ... */
    </style>
</head>
<body>
    <!-- ... (keep all HTML elements unchanged) ... -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;

        // Geolocation function
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const addressField = document.getElementById('address');
                        addressField.value = `Lat: ${position.coords.latitude.toFixed(6)}, Long: ${position.coords.longitude.toFixed(6)}`;
                    },
                    error => {
                        alert(`Error getting location: ${error.message}`);
                    }
                );
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        async function generatePDF() {
            try {
                const doc = new jsPDF();
                
                // Set default font style
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(12);

                // Get form data
                const formData = {
                    address: document.getElementById('address').value,
                    inspector: document.getElementById('inspector').value,
                    date: document.getElementById('date').value,
                    roofType: document.getElementById('roof-type').value,
                    issues: document.getElementById('issues').value,
                    photos: document.getElementById('photos').files
                };

                // Create PDF header
                doc.setFontSize(18);
                doc.text("Roof Inspection Report", 20, 20);

                // Report details
                let yPos = 40;
                doc.setFontSize(12);
                doc.text(`Address: ${formData.address}`, 20, yPos);
                yPos += 10;
                doc.text(`Inspector: ${formData.inspector}`, 20, yPos);
                yPos += 10;
                doc.text(`Date: ${formData.date}`, 20, yPos);
                yPos += 10;
                doc.text(`Roof Type: ${formData.roofType}`, 20, yPos);
                yPos += 15;

                // Issues section
                doc.setFont('helvetica', 'bold');
                doc.text("Issues Found:", 20, yPos);
                doc.setFont('helvetica', 'normal');
                yPos += 7;
                const splitText = doc.splitTextToSize(formData.issues, 170);
                doc.text(splitText, 20, yPos);
                yPos += (splitText.length * 7) + 10;

                // Photo handling
                if(formData.photos.length > 0) {
                    doc.setFont('helvetica', 'bold');
                    doc.text("Attached Photos:", 20, yPos);
                    doc.setFont('helvetica', 'normal');
                    yPos += 10;

                    for(let i = 0; i < formData.photos.length; i++) {
                        const img = await readFileAsDataURL(formData.photos[i]);
                        const imgProps = doc.getImageProperties(img);
                        const pdfWidth = doc.internal.pageSize.getWidth() - 40;
                        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                        if(yPos + pdfHeight > doc.internal.pageSize.getHeight() - 20) {
                            doc.addPage();
                            yPos = 20;
                        }

                        doc.addImage(img, 'JPEG', 20, yPos, pdfWidth, pdfHeight);
                        yPos += pdfHeight + 10;
                    }
                }

                // Save PDF
                doc.save(`Roof-Inspection-Report-${Date.now()}.pdf`);
            } catch (error) {
                alert(`Error generating PDF: ${error.message}`);
                console.error(error);
            }
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>