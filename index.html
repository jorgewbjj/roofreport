<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roof Inspection Report</title>
    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Keep previous styles */
    </style>
</head>
<body>
    <!-- Keep previous form content -->

    <script>
        // Keep previous geolocation code

        document.getElementById('reportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            generatePDF();
        });

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get form values
            const formData = {
                address: document.getElementById('address').value,
                inspector: document.getElementById('inspector').value,
                date: document.getElementById('date').value,
                roofType: document.getElementById('roof-type').value,
                issues: document.getElementById('issues').value,
                photos: document.getElementById('photos').files
            };

            // PDF Content
            doc.setFontSize(18);
            doc.text("Roof Inspection Report", 20, 20);
            doc.setFontSize(12);

            let yPosition = 40;
            
            // Add report details
            doc.text(`Property Address: ${formData.address}`, 20, yPosition);
            yPosition += 10;
            doc.text(`Inspector: ${formData.inspector}`, 20, yPosition);
            yPosition += 10;
            doc.text(`Inspection Date: ${formData.date}`, 20, yPosition);
            yPosition += 10;
            doc.text(`Roof Type: ${formData.roofType}`, 20, yPosition);
            yPosition += 15;

            // Add issues
            doc.setFontStyle('bold');
            doc.text("Issues Found:", 20, yPosition);
            doc.setFontStyle('normal');
            yPosition += 7;
            const splitIssues = doc.splitTextToSize(formData.issues, 170);
            doc.text(splitIssues, 20, yPosition);
            yPosition += (splitIssues.length * 7) + 10;

            // Add photos
            if(formData.photos.length > 0) {
                doc.setFontStyle('bold');
                doc.text("Attached Photos:", 20, yPosition);
                yPosition += 10;
                
                for(let i = 0; i < formData.photos.length; i++) {
                    const img = await readFileAsDataURL(formData.photos[i]);
                    const imgProps = doc.getImageProperties(img);
                    const pdfWidth = doc.internal.pageSize.getWidth() - 40;
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    
                    // Add new page if needed
                    if(yPosition + pdfHeight > doc.internal.pageSize.getHeight() - 20) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.addImage(img, 'JPEG', 20, yPosition, pdfWidth, pdfHeight);
                    yPosition += pdfHeight + 10;
                }
            }

            // Save PDF
            doc.save(`Roof-Inspection-Report-${Date.now()}.pdf`);
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
