<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roof Inspection Report</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .issue-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .add-btn {
            background-color: #4CAF50;
            color: white;
        }
        .remove-btn {
            background-color: #ff4444;
            color: white;
        }
        .submit-btn {
            background-color: #2196F3;
            color: white;
            float: right;
        }
    </style>
</head>
<body>
    <h1>Roof Inspection Report</h1>

    <div class="form-group">
        <label>Property Address:</label>
        <input type="text" id="address" required>
    </div>

    <div class="form-group">
        <label>Inspector Name:</label>
        <select id="inspector" required>
            <option value="Arister">Arister</option>
            <option value="Jorge">Jorge</option>
            <option value="Pedro">Pedro</option>
        </select>
    </div>

    <div class="form-group">
        <label>Inspection Date:</label>
        <input type="date" id="date" required>
    </div>

    <div class="form-group">
        <label>Roof Type:</label>
        <select id="roof-type" required>
            <option value="asphalt">Asphalt Shingles</option>
            <option value="metal">Metal</option>
            <option value="tile">Tile</option>
        </select>
    </div>

    <div id="issues-container">
        <div class="issue-section">
            <label>Issue Description:</label>
            <textarea class="issue-desc" required></textarea>
            <label>Upload Photos for this Issue:</label>
            <input type="file" class="issue-photos" multiple accept="image/*">
            <button type="button" class="remove-btn" onclick="removeIssue(this)">Remove Issue</button>
        </div>
    </div>

    <button class="add-btn" onclick="addIssue()">Add Another Issue</button>
    <button class="submit-btn" onclick="generatePDF()">Generate Report</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;
        let issueCount = 1;

        function addIssue() {
            const container = document.getElementById('issues-container');
            const newIssue = document.createElement('div');
            newIssue.className = 'issue-section';
            newIssue.innerHTML = `
                <label>Issue Description:</label>
                <textarea class="issue-desc" required></textarea>
                <label>Upload Photos for this Issue:</label>
                <input type="file" class="issue-photos" multiple accept="image/*">
                <button type="button" class="remove-btn" onclick="removeIssue(this)">Remove Issue</button>
            `;
            container.appendChild(newIssue);
            issueCount++;
        }

        function removeIssue(button) {
            if(issueCount > 1) {
                button.parentElement.remove();
                issueCount--;
            }
        }

        async function generatePDF() {
            try {
                const doc = new jsPDF();
                
                // Set default styles
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(12);

                // Header Section
                doc.setFontSize(18);
                doc.text("Roof Inspection Report", 20, 20);

                // Basic Information
                let yPos = 40;
                const details = [
                    `Address: ${document.getElementById('address').value}`,
                    `Inspector: ${document.getElementById('inspector').value}`,
                    `Date: ${document.getElementById('date').value}`,
                    `Roof Type: ${document.getElementById('roof-type').value}`
                ];

                details.forEach(line => {
                    doc.text(line, 20, yPos);
                    yPos += 10;
                });

                // Issues Section
                const issueSections = document.getElementsByClassName('issue-section');
                yPos += 10;
                
                for(let i = 0; i < issueSections.length; i++) {
                    const issue = issueSections[i];
                    const desc = issue.querySelector('.issue-desc').value;
                    const photos = issue.querySelector('.issue-photos').files;

                    doc.setFont('helvetica', 'bold');
                    doc.text(`Issue ${i + 1}:`, 20, yPos);
                    doc.setFont('helvetica', 'normal');
                    yPos += 7;
                    
                    const issuesText = doc.splitTextToSize(desc, 170);
                    doc.text(issuesText, 20, yPos);
                    yPos += (issuesText.length * 7) + 10;

                    // Add photos for this issue
                    for(let j = 0; j < photos.length; j++) {
                        const img = await readFile(photos[j]);
                        const imgProps = doc.getImageProperties(img);
                        
                        // Scale image to 25% size
                        const scaleFactor = 0.25;
                        let width = imgProps.width * scaleFactor;
                        let height = imgProps.height * scaleFactor;

                        // Adjust if too wide
                        const maxWidth = doc.internal.pageSize.getWidth() - 40;
                        if(width > maxWidth) {
                            const ratio = maxWidth / width;
                            width *= ratio;
                            height *= ratio;
                        }

                        // Page break check
                        if(yPos + height > doc.internal.pageSize.getHeight() - 20) {
                            doc.addPage();
                            yPos = 20;
                        }

                        doc.addImage(img, 'JPEG', 20, yPos, width, height);
                        yPos += height + 10;
                    }
                }

                doc.save(`Roof-Report-${new Date().toISOString().slice(0,10)}.pdf`);
            } catch (error) {
                alert(`Error generating PDF: ${error.message}`);
            }
        }

        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
